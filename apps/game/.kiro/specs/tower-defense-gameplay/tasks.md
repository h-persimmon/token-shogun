# Implementation Plan

- [x] 1. 新規コンポーネントの実装
  - 新しいコンポーネント（TargetComponent、EnemyComponent、UnitComponent）を作成し、既存のECSアーキテクチャに統合する
  - 各コンポーネントのユーティリティ関数とタイプガードを実装する
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 1.1 TargetComponentの実装
  - TargetComponentの型定義とファクトリ関数を作成する
  - 攻撃対象の管理機能（設定、クリア、優先度評価）を実装する
  - TargetComponentのユニットテストを作成する
  - _Requirements: 2.2, 3.1, 3.4_

- [x] 1.2 EnemyComponentの実装
  - EnemyComponentの型定義とファクトリ関数を作成する
  - 敵の種類別設定（basic、fast、heavy）を実装する
  - EnemyComponentのユニットテストを作成する
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 1.3 UnitComponentの実装
  - UnitComponentの型定義とファクトリ関数を作成する
  - 砲台配備状態の管理機能を実装する
  - UnitComponentのユニットテストを作成する
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 1.4 既存コンポーネントの拡張
  - StructureComponentにユニット配備機能を追加する
  - ComponentMapとindexファイルを新しいコンポーネントで更新する
  - 拡張されたコンポーネントのテストを作成する
  - _Requirements: 2.4, 7.1, 7.4_

- [x] 2. TargetingSystemの実装
  - エンティティの攻撃対象選択と管理を行うTargetingSystemを実装する
  - 攻撃範囲内の敵検索と優先度に基づく目標選択アルゴリズムを作成する
  - _Requirements: 2.2, 3.1, 3.4, 6.1, 6.2_

- [x] 2.1 基本的なTargetingSystemクラスの作成
  - TargetingSystemクラスの基本構造を実装する
  - EntityManagerとの統合とエンティティクエリ機能を実装する
  - 攻撃範囲内のエンティティ検索機能を作成する
  - _Requirements: 2.2, 3.1, 7.3_

- [x] 2.2 目標選択アルゴリズムの実装
  - 距離と優先度に基づく最適な攻撃目標選択ロジックを実装する
  - 敵/味方の判定と目標の有効性チェック機能を作成する
  - 目標変更の管理機能を実装する
  - _Requirements: 3.1, 3.4, 6.1_

- [x] 2.3 TargetingSystemのテスト作成
  - TargetingSystemの各機能のユニットテストを作成する
  - 目標選択アルゴリズムの正確性をテストする
  - エッジケース（目標なし、範囲外等）のテストを実装する
  - _Requirements: 2.2, 3.1, 3.4_

- [x] 3. AttackSystemの実装
  - 戦闘処理とダメージ計算を行うAttackSystemを実装する
  - 攻撃クールダウン管理と撃破判定機能を作成する
  - _Requirements: 2.2, 3.2, 3.3, 6.2_

- [x] 3.1 基本的なAttackSystemクラスの作成
  - AttackSystemクラスの基本構造を実装する
  - 攻撃可能なエンティティの検索とクールダウン管理を実装する
  - 既存のAttackComponentとの統合を行う
  - _Requirements: 2.2, 3.2, 7.3_

- [x] 3.2 ダメージ計算と適用システムの実装
  - ダメージ計算ロジックとHealthComponentへの適用を実装する
  - 撃破判定とエンティティ削除処理を作成する
  - 攻撃エフェクトの表示機能を実装する
  - _Requirements: 3.2, 3.3, 6.2_

- [x] 3.3 AttackSystemのテスト作成
  - AttackSystemの各機能のユニットテストを作成する
  - ダメージ計算の正確性とクールダウン管理をテストする
  - 撃破判定とエンティティ削除のテストを実装する
  - _Requirements: 2.2, 3.2, 3.3_

- [x] 4. EnemySpawnSystemの実装
  - 時間経過に基づく敵の生成と管理を行うEnemySpawnSystemを実装する
  - ウェーブ設定に基づく敵の定期生成機能を作成する
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 4.1 基本的なEnemySpawnSystemクラスの作成
  - EnemySpawnSystemクラスの基本構造を実装する
  - ウェーブ設定データ構造とスポーン地点管理を実装する
  - ObjectPoolとの統合による効率的なエンティティ生成を作成する
  - _Requirements: 1.1, 1.3, 7.2_

- [x] 4.2 敵生成ロジックの実装
  - 時間経過に基づく敵の定期生成機能を実装する
  - 敵の種類別生成ロジック（basic、fast、heavy）を作成する
  - 生成タイミングの制御とウェーブ進行管理を実装する
  - _Requirements: 1.1, 1.2, 1.4_

- [x] 4.3 EnemySpawnSystemのテスト作成
  - EnemySpawnSystemの各機能のユニットテストを作成する
  - 敵生成タイミングとウェーブ進行の正確性をテストする
  - ObjectPool統合とメモリ効率のテストを実装する
  - _Requirements: 1.1, 1.2, 1.3, 7.2_

- [x] 5. GameStateSystemの実装
  - ゲーム全体の状態管理と勝敗判定を行うGameStateSystemを実装する
  - 勝利条件と敗北条件の判定機能を作成する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4_

- [x] 5.1 基本的なGameStateSystemクラスの作成
  - GameStateSystemクラスの基本構造を実装する
  - ゲーム状態データ構造と状態遷移管理を実装する
  - ゲーム状態の監視機能を作成する
  - _Requirements: 4.1, 5.1, 6.4_

- [x] 5.2 勝敗判定ロジックの実装
  - 勝利条件（全敵撃破）の判定機能を実装する
  - 敗北条件（門破壊）の判定機能を作成する
  - ゲーム終了時の処理とUI表示を実装する
  - _Requirements: 4.2, 4.3, 4.4, 5.2, 5.3, 5.4_

- [x] 5.3 GameStateSystemのテスト作成
  - GameStateSystemの各機能のユニットテストを作成する
  - 勝敗判定ロジックの正確性をテストする
  - 状態遷移とゲーム終了処理のテストを実装する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4_

- [x] 6. 砲台配備システムの実装
  - 砲台への味方ユニット配備機能を実装する
  - 配備UIとユーザーインタラクション機能を作成する
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 6.1 配備システムの基本機能実装
  - 砲台選択とユニット配備の基本ロジックを実装する
  - StructureComponentとUnitComponentの連携機能を作成する
  - 配備可能性の判定機能を実装する
  - _Requirements: 2.1, 2.2, 2.4_

- [x] 6.2 配備UIとインタラクションの実装
  - 砲台クリック時の配備UI表示機能を実装する
  - 利用可能なユニット一覧の表示と選択機能を作成する
  - 配備実行とキャンセル機能を実装する
  - _Requirements: 2.1, 2.3_

- [x] 6.3 配備システムのテスト作成
  - 配備システムの各機能のユニットテストを作成する
  - UI表示とユーザーインタラクションのテストを実装する
  - 配備状態管理の正確性をテストする
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 7. システム統合とシーン更新
  - 新しいシステムを既存のGameSceneに統合する
  - リアルタイム更新処理とシステム間連携を実装する
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 7.1, 7.3, 7.4_

- [x] 7.1 GameSceneへのシステム統合
  - 新しいシステム（TargetingSystem、AttackSystem、EnemySpawnSystem、GameStateSystem）をGameSceneに追加する
  - システム初期化とEntityManagerとの連携を実装する
  - システム間の依存関係を適切に設定する
  - _Requirements: 7.1, 7.3, 7.4_

- [x] 7.2 リアルタイム更新処理の実装
  - GameSceneのupdateメソッドで各システムの更新処理を実装する
  - フレームレート最適化とパフォーマンス監視を追加する
  - システム更新順序の最適化を行う
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [x] 7.3 UI表示とゲーム状態の統合
  - ゲーム状態情報（残り敵数、ウェーブ情報、ゲート体力）の表示を実装する
  - 勝敗判定時のUI表示とゲーム終了処理を作成する
  - デバッグ情報とパフォーマンス統計の表示を追加する
  - _Requirements: 4.3, 5.2, 5.3, 6.4_

- [ ] 8. 統合テストと最終調整
  - 全システムの統合テストを実行する
  - パフォーマンス最適化と最終的なバグ修正を行う
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 6.4, 7.1, 7.2, 7.3, 7.4_

- [ ] 8.1 エンドツーエンド統合テストの実装
  - 敵生成から撃破までの完全なゲームフローをテストする
  - 砲台配備システムの統合動作をテストする
  - 勝敗判定とゲーム状態遷移の統合テストを実装する
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1_

- [ ] 8.2 パフォーマンス最適化と負荷テスト
  - 大量エンティティでの動作確認とフレームレート最適化を実行する
  - メモリ使用量の監視とObjectPool効率の検証を行う
  - リアルタイム性の確認と入力レスポンスの最適化を実装する
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 7.2_

- [ ] 8.3 最終バグ修正とコード品質向上
  - 統合テストで発見されたバグの修正を行う
  - コードレビューと品質改善を実施する
  - ドキュメントの更新と使用例の追加を行う
  - _Requirements: 7.1, 7.3, 7.4_